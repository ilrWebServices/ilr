{#
/**
 * @file
 * Theme override to display a report summary node in Compact with Media view mode.
 *
 * This template displays report summaries in a carousel with hover overlay effect.
 * Shows the title and emphasized title text over the representative image.
 */
#}
{{ attach_library('union_organizer/card') }}
{% set emphasized_title = node.field_emphasized_title_text.value %}
{% set title_text = node.label|render|striptags %}

{# If emphasized title text is set and matches a portion of the title, wrap it in strong tags #}
{% if emphasized_title and emphasized_title in title_text %}
  {% set title_with_emphasis = title_text|replace({(emphasized_title): '<strong>' ~ emphasized_title ~ '</strong>'}) %}
{% else %}
  {% set title_with_emphasis = title_text %}
{% endif %}

{% set rendered_content %}
  {{ title_suffix }}
  <h3 class="cu-composite-heading__heading">{{ title_with_emphasis|raw }}</h3>
  <div class="cu-card__hover-overlay-content">
    <span class="cu-card__hover-text">Read Report</span>
    <span class="cu-card__hover-icon">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="#B31B1B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </span>
  </div>
{% endset %}

{% set media_content %}
  {% if node.field_representative_image.entity.field_media_image.entity %}
    {% set image = node.field_representative_image.entity.field_media_image.entity %}
    <img src="{{ file_url(image.uri.value) }}" alt="{{ image.alt }}" />
  {% endif %}
{% endset %}

{% include '@union/_card.twig' with {
  card_content: rendered_content,
  card_media: media_content,
  card_link_url: url,
  card_link_alt: label,
  link_attributes: url_attributes,
  content_attributes: { class: 'cu-card__content--hover-overlay' },
  attributes: attributes.addClass([
    'cu-card--hover-overlay',
    'node--' ~ node.bundle|clean_class,
    not node.isPublished() ? 'node--unpublished',
    view_mode ? 'node--view-mode-' ~ view_mode|clean_class,
  ])
} only %}
